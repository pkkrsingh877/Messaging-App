<% layout('/layouts/boilerplate') %>

<h2>Login</h2>
    <form action="/auth/login" method="post">
        <div class="mb-3">
            <label for="username" class="form-label">
            Enter Username:
            </label> <br> 
            <input type="text" name="username"
            id="username" placeholder="username" class="form-control">
            <div class="username error small red"></div>
        </div>    
        <div class="mb-3">
            <label for="password" class="form-label">Enter Password: </label> <br> 
            <input type="password" name="password"
            id="password" placeholder="password" class="form-control">
            <div class="password error small red"></div>
        </div>
        <button class="btn btn-success">Login</button>
    </form>
    <section class="description mt-3">
        Don't have an account?<br>
    <a href="/user/signup" class="btn btn-secondary mt-1" style="color: white!important;">Signup</a>    
    </section>

    <script>
        const form = document.querySelector('form');
        const username = document.querySelector('.username.error');
        const password = document.querySelector('.password.error');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            username.textContent = '';
            password.textContent = '';
            try {
                const res = await fetch('/user/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        username: form.username.value,
                        password: form.password.value
                    }),
                    headers: { 'Content-Type': 'application/json' }
                });
                const response = await res.json();
                console.log(response);
                if(response.userId){
                    location.assign(`http://localhost:8000/user/${response.userId}`);
                }
            } catch (err) {
                console.log(err);
            }
        });
    </script>
    